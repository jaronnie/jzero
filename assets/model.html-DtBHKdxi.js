import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,e as t}from"./app-DGgcsrdQ.js";const e={},o=t(`<p>jzero 推荐使用 go-zero sqlx 完成对数据库的 crud 操作.</p><p>jzero 数据库规范:</p><ul><li>sql 文件放在 daemon/desc/sql</li><li>生成的 model 放在 daemon/model</li></ul><p>jzero gen 时会自动检测 daemon/desc/sql 下的 sql 文件, 并将生成的 model 放在 daemon/model 下</p><p>另外推荐使用 sqlbuilder 完成对 sql 的拼接. 如获取凭证列表以及支持过滤参数</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>go get github.com/huandu/go-sqlbuilder
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>customCredentialModel<span class="token punctuation">)</span> <span class="token function">CredentialList</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> options <span class="token operator">*</span>credentialpb<span class="token punctuation">.</span>CredentialListRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Credential<span class="token punctuation">,</span> <span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	sb <span class="token operator">:=</span> sqlbuilder<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">From</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>table<span class="token punctuation">)</span>
	countsb <span class="token operator">:=</span> sqlbuilder<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;count(*)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">From</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>table<span class="token punctuation">)</span>

	<span class="token keyword">if</span> options<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
		sb<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">Like</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		countsb<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">Like</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	sb<span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span><span class="token function">GetSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span><span class="token function">GetPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> options<span class="token punctuation">.</span><span class="token function">GetSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">var</span> credentials <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Credential

	err <span class="token operator">:=</span> m<span class="token punctuation">.</span>conn<span class="token punctuation">.</span><span class="token function">QueryRowsCtx</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>credentials<span class="token punctuation">,</span> sb<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>

	<span class="token comment">// get total</span>
	<span class="token keyword">var</span> total <span class="token builtin">int64</span>
	err <span class="token operator">=</span> m<span class="token punctuation">.</span>conn<span class="token punctuation">.</span><span class="token function">QueryRowCtx</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>total<span class="token punctuation">,</span> countsb<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> credentials<span class="token punctuation">,</span> total<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),p=[o];function c(l,i){return s(),a("div",null,p)}const k=n(e,[["render",c],["__file","model.html.vue"]]),d=JSON.parse('{"path":"/guide/develop/model.html","title":"model 数据库","lang":"zh-CN","frontmatter":{"title":"model 数据库","icon":"puzzle-piece","star":true,"order":5,"category":"开发","tag":["Guide"],"description":"jzero 推荐使用 go-zero sqlx 完成对数据库的 crud 操作. jzero 数据库规范: sql 文件放在 daemon/desc/sql 生成的 model 放在 daemon/model jzero gen 时会自动检测 daemon/desc/sql 下的 sql 文件, 并将生成的 model 放在 daemon/model ...","head":[["meta",{"property":"og:url","content":"https://jzero.jaronnie.com/guide/develop/model.html"}],["meta",{"property":"og:site_name","content":"Jzero Framework"}],["meta",{"property":"og:title","content":"model 数据库"}],["meta",{"property":"og:description","content":"jzero 推荐使用 go-zero sqlx 完成对数据库的 crud 操作. jzero 数据库规范: sql 文件放在 daemon/desc/sql 生成的 model 放在 daemon/model jzero gen 时会自动检测 daemon/desc/sql 下的 sql 文件, 并将生成的 model 放在 daemon/model ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-24T03:53:55.000Z"}],["meta",{"property":"article:author","content":"jaronnie"}],["meta",{"property":"article:tag","content":"Guide"}],["meta",{"property":"article:modified_time","content":"2024-04-24T03:53:55.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"model 数据库\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-04-24T03:53:55.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"jaronnie\\",\\"url\\":\\"https://github.com/jaronnie\\"}]}"]]},"headers":[],"git":{"createdTime":1713851121000,"updatedTime":1713930835000,"contributors":[{"name":"jaronnie","email":"jaron@jaronnie.com","commits":2}]},"readingTime":{"minutes":0.63,"words":190},"filePathRelative":"guide/develop/model.md","localizedDate":"2024年4月23日","autoDesc":true}');export{k as comp,d as data};
